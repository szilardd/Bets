var AdminPage=(function(){var a;var l=function(m){this.RoundID=ko.observable();this.FirstTeamID=ko.observable();this.SecondTeamID=ko.observable();this.Date=ko.observable();this.Points1=ko.observable();this.PointsX=ko.observable();this.Points2=ko.observable()};var b={matches:ko.observableArray(),addMatch:function(){this.matches.push(new l());Bootstrapper.bindDropdowns(a);Bootstrapper.bindDatePickers(".Date")},removeMatch:function(m){if(this.matches().length<=1){return}this.matches.remove(m);Bootstrapper.bindDropdowns(a);Bootstrapper.bindDatePickers(".Date")},save:function(){var n=$(this),m=n.parent();Utils.blockElement(m,true);AjaxUtils.post({url:"Admin/AddMatches",json:true,dataType:"json",data:ko.toJSON({matches:b.matches}),success:function(o){j(o,n)},error:function(){j(false,n)}})}};function j(n,m){if(!n){m.next().removeClass().addClass("error-icon")}else{m.next().removeClass().addClass("success-icon")}Utils.unblockElement(m.parent(),true)}function c(){ko.bindingConventions.conventions("#admin-content",{"#admin-content":{"with":b},".match-list":function(m){return{foreach:m.matches}},".RoundID":function(m){return{value:m.RoundID}},".FirstTeamID":function(m){return{value:m.FirstTeamID}},".SecondTeamID":function(m){return{value:m.SecondTeamID}},".Date":function(m){return{value:m.Date}},".Points1":function(m){return{value:m.Points1}},".PointsX":function(m){return{value:m.PointsX}},".Points2":function(m){return{value:m.Points2}},".btnAddMatch":{click:function(){b.addMatch()}},".btnRemoveMatch":{click:function(){b.removeMatch(this)}}});ko.applyBindings(b);b.addMatch();a.find(".btn-add-matches").click(b.save)}function d(){a.find(".btn-add-match-result").click(function(){var o=$(this),m=o.parent(),n=$("#MatchID");Utils.blockElement(m,true);AjaxUtils.post({url:"Admin/AddMatchResult",data:{ID:n.val(),FirstTeamGoals:$("#FirstTeamGoals").val(),SecondTeamGoals:$("#SecondTeamGoals").val()},dataType:"json",success:function(p){j(p,o)},error:function(p){j(false,o)}})})}function e(){var m=a.find(".goal-container"),n=$("#GoalsScored"),o=$("#GoalsScoredTotal"),p=$("#PlayerID");n.mousedown(function(){return false});p.change(function(){var q=$(this).find(":selected");n.val(q.data("custom")||0);o.text(q.data("custom2")||0)});m.delegate(".btn-goal","click",function(){var q=$(this),s=parseInt(q.data("val")),r=parseInt(n.val())+s;if(r>=0||s==1){o.text(parseInt(o.text())+s)}if(!r||r<0){r=0}n.val(r)});m.find(".btn-save-goals").click(function(){var r=$(this),q=r.parent();Utils.blockElement(q,true);AjaxUtils.post({url:"Admin/AddGoalscorerForRound",data:{GoalscorerID:$("#PlayerID").val(),Goals:$("#GoalsScored").val()},dataType:"json",success:function(s){if(s){p.find(":selected").data("custom",n.val()).data("custom2",o.text())}j(s,r)},error:function(s){j(false,r)}})})}function f(){a.find(".btn-add-round").click(function(){var n=$(this),m=n.parent();Utils.blockElement(m,true);AjaxUtils.post({url:"Admin/AddRound",data:{Name:$("#RoundName").val()},dataType:"json",success:function(o){j(o,n)},error:function(o){j(false,n)}})})}function i(){a.find(".btn-remove-team").click(function(){var o=$(this),m=o.parent(),n=$("#RemoveTeamID");Utils.blockElement(m,true);AjaxUtils.post({url:"Admin/RemoveTeam",data:{ID:n.val()},dataType:"json",success:function(p){if(p){n.find(":selected").remove();n.trigger("liszt:updated")}j(p,o)},error:function(p){j(false,o)}})})}function h(){a.find(".btn-remove-player").click(function(){var o=$(this),m=o.parent(),n=$("#RemovePlayerID");Utils.blockElement(m,true);AjaxUtils.post({url:"Admin/RemovePlayer",data:{ID:n.val()},dataType:"json",success:function(p){if(p){n.find(":selected").remove();n.trigger("liszt:updated")}j(p,o)},error:function(p){j(false,o)}})})}function g(){a.find(".btn-close-round").click(function(){var n=$(this),m=n.parent();Utils.blockElement(m,true);AjaxUtils.post({url:"Admin/CloseCurrentRound",dataType:"json",success:function(o){j(o,n)},error:function(o){j(false,n)}})})}function k(){a=$("#admin-content");c();d();e();f();i();g();h()}return{init:k}}());$(function(){AdminPage.init()});